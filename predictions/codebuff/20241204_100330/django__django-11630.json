{
    "instance_id": "django__django-11630",
    "model_name_or_path": "codebuff",
    "model_patch": "diff --git a/django/core/checks/model_checks.py b/django/core/checks/model_checks.py\nindex 5c2266ca1d..0745afe0c9 100644\n--- a/django/core/checks/model_checks.py\n+++ b/django/core/checks/model_checks.py\n@@ -35,16 +35,25 @@ def check_all_models(app_configs=None, **kwargs):\n             indexes[model_index.name].append(model._meta.label)\n         for model_constraint in model._meta.constraints:\n             constraints[model_constraint.name].append(model._meta.label)\n-    for db_table, model_labels in db_table_models.items():\n-        if len(model_labels) != 1:\n-            errors.append(\n-                Error(\n-                    \"db_table '%s' is used by multiple models: %s.\"\n-                    % (db_table, ', '.join(db_table_models[db_table])),\n-                    obj=db_table,\n-                    id='models.E028',\n+    # Group models by database and table name\n+    db_table_models_by_db = defaultdict(lambda: defaultdict(list))\n+    for model in models:\n+        if model._meta.managed and not model._meta.proxy:\n+            db = router.db_for_write(model)\n+            db_table_models_by_db[db][model._meta.db_table].append(model._meta.label)\n+\n+    # Check for duplicate table names within each database\n+    for db, tables in db_table_models_by_db.items():\n+        for db_table, model_labels in tables.items():\n+            if len(model_labels) != 1:\n+                errors.append(\n+                    Error(\n+                        \"db_table '%s' is used by multiple models in database '%s': %s.\"\n+                        % (db_table, db, ', '.join(model_labels)),\n+                        obj=db_table,\n+                        id='models.E028',\n+                    )\n                 )\n-            )\n     for index_name, model_labels in indexes.items():\n         if len(model_labels) > 1:\n             model_labels = set(model_labels)\n",
    "cost": 0,
    "edit_outcome": true,
    "lint_outcome": true,
    "test_outcome": false,
    "resolved": false
}